## 3.1 컨테이너 서비스

### 3.1.1 컨테이너 서비스란?

- 컨테이너의 사전적 의미: 어떤 사물을 격리할 수 있는 공간

  → 우리가 서비스하고자 하는 애플리케이션 코드, 프로세스를 격리한다는 의미로서 컨테이너라는 워딩을 활용!

- 애플리케이션 개발 환경이 컨테이너 서비스 환경으로 전환된 이유?
    - Pain point: 가변적 인프라 환경으로 인한 일관성 없는 환경 제공 때문!
        - 개발, 테스트, 배포, 운영의 컴퓨팅 환경 차이로 인한 시행착오 & 다양한 오류 해결에 너무 많은 시간을 쏟는다..!
- 컨테이너 서비스: 논리적 패키징 매커니즘 제공
    - 애플리케이션에 필요한 바이너리, 라이브러리 및 구성 팡리 등을 패키지로 묶어 배포

### 3.1.2 왜 도커 컨테이너 서비스일까?

- 도커를 이용한 컨테이너 애플리케이션 서비스 개발 과정
    1. 애플리케이션 코드 개발
        - 특정 서비스 구동을 위한 애플리케이션 코드 및 웹 화면 구성 등을 위한 코드 개발
    2. 베이스 이미지를 이용한 Dockerfile 작성
        - 개발에 필요한 인프라 구성 요소를 Dockerfile에 작성.
        - 도커 허브를 통해 베이스 이미지를 다운로드하고 다양한 구동 명령어와 1에서 작성한 애플리케이션 코드, 라이브러리 등을 Dockerfile에 포함시킨다.
    3. Dockerfile build를 통한 새로운 이미지 생성
        - docker build 명령을 통해 작성한 Dockerfile을 실행. 각 단계별로 실행되는 로그를 화면에서 확인하며 이때 오류 발생 내용도 확인.
    4. 컨테이너 실행
        1. 생성된 이미지를 이용한 컨테이너 생성
            - 도커 명령어 docker images를 통해 생성된 이미지를 확인하고 이미지를 통한 컨테이너를 구동(`docker run`)한다.
        2. 도커 컴포즈를 이용한 다중 컨테이너 실행
            - 도커 실행 옵션을 미리 작성한 docker-compose.yml을 통해 다중 컨테이너간 실행 순서, 네트워크, 의존성 등을 통합 관리할 수 있고 마이크로서비스 개발에 활용.
    5. 서비스 테스트
        1. 컨테이너 애플리케이션 서비스 테스트
            - ex) Nginx를 이용한 웹 애플리케이션 컨테이너 서비스였다면 연결하는 IP와 포트 번호를 이용해 웹 브라우저를 이용한 페이지 연결 확인
        2. 마이크로서비스 테스트
            - 해당 서비스에 대한 테스트 진행
    6. 로컬 및 원격 저장소에 이미지 저장(push)
        - 로컬 및 원격에 있는 이미지 저장소에 생성한 이미지를 저장해 다른 팀 간의 공유 및 지속적인 이미지 관리 수행
    7. 깃허브 등을 활용한  Dockerfile 관리
        - Dockerfile 코드를 깃허브 사이트에 저장 및 관리할 수 있고, 도커 허브 사이트와 연동하게 되면 자동화된 빌드 기능을 이용한 이미지 생성도 가능
    8. 동일 환경에서의 지속적 애플리케이션 개발 수행
        - 1~7 과정을 통해 업무용 애플리케이션 이미지를 지속적으로 개발, 운영 및 관리할 수 있음.
- 도커 작동에서 눈여겨볼 것: 컨테이너 동작에 필요한 모든 내용을 사전에 코드로 작성해 자동화 → IaC

## 3.2 도커 명령어 활용

### 3.2.1 도커 이미지 명령어

- 도커 컨테이너: 도커 허브에서 제공하는 이미지를 기반으로 실행
- 도커 이미지: 도커의 핵심 기술 → 코드로 개발된 컨테이너 내부 환경 정보(바이너리, 라이브러리, 각종 도구 등)를 고스란히 복제해서 사용 가능
- 도커 컨테이너로 사용할 도커 이미지: docker search를 통해 조회 → 도커 허브 & 개인 사용자들이 공개한 관련 이미지 서치 가능
- 로컬 서버 & 데스크톱에 도커 이미지 저장하려면
    - Dockerfile을 통해 새로운 이미지를 생성: docker build
        - Dockerfile로 생성한 이미지는 도커 허브에 업로드 가능(docker push)
    - 도커 허브로부터 이미지를 내려받기: docker pull

**도커 이미지 내려받기**

- 도커 허브 레지스트리로부터 도커 이미지를 내려받거나 레지스트리에 업로드하는 과정을 수행하기 위해 아래의 명령 사용
    - docker pull: 도커 허브 레지스트리에서 로컬로 도커 이미지 내려받기
        - docker pull 명령을 이용할 때 옵션 & 태그 등으로 세부 사항 지정 가능

          **`실습: debian 다운로드`**

          ![img.png](img.png)

            ```bash
            docker [image] pull [OPTIONS] name[:TAG | @IMAGE_DIGEST]
            
            1. Using default tag: latest
            2. latest: Pulling from library/debian
            3. 90fe46dd8199: Pull complete
            4. Digest: sha256: 281p2asdfnj123hiuhskjdf
            5. Status: Downloaded newer image for debian:latest
            6. docker.io/
            ```

            1. 태그: 이미지 뒤에 태그를 따로 명시하지 않으면 최신 버전(latest)으로 다운받는다. 특정 버전을 지정하면 latest 대신 지정한 버전명이 포함된다.
            2. 라이브러리: 도커 허브가 이미지를 저장하고 있는 네임스페이스로 제공
            3. 도커 허브에서 제공된 이미지의 분산 해시 값 표시. 다운로드한 이미지는 여러 계층으로 만들어지는데 그중 이미지 핵심 정보를 바이너리 형태의 정보로 제공
            4. 다이제스트값: 원격 도커 레지스트리(도커 허브)에서 관리하는 이미지의 고유 식별값
            5. 다운로드 완료
            6. docker.io: 도커 허브 이미지 저장소 주소
        - 다운로드한 이미지 정보는 docker image ls를 통해 조회 가능
    - docker push: 로컬에 있는 도커 이미지를 도커 허브 레지스트리에 업로드
    - docker login: 업로드를 하기 전 도커 허브 계정으로 로그인 수행하기
    - docker logout: 도커 허브에서 로그아웃하기

**도커 이미지 세부 정보 조회**

- 도커 오브젝트에 대한 세부 정보 조회를 위해 docker image inspect, docker image history, 물리적으로 호스트 운영체제에 저장된 영역을 이용하기 등이 있다.
    1. `docker inspect`: JSON 언어 형태로 정보 출력 → 포맷 옵션을 이용해 원하는 정보만 출력 가능

        ```bash
        docker image inspect [OPTIONS] IMAGE [IMAGE...]
        ```

        - **`실습: 아파치 웹 서비스를 할 수 있는 httpd 도커 이미지 다운로드`**
            1. `docker search httpd`: 수행 전 hub.docker.com에 가입한 본인 계정으로 docker login을 먼저 수행하고 조회(docker login 이후 docker search 사용)

               ![img_1.png](img_1.png)

            2. `docker pull httpd(:latest)`: httpd 최신 버전으로 다운로드

               ![img_2.png](img_2.png)

            3. `docker images`: 다운로드한 이미지 조회

               ![img_3.png](img_3.png)

            4. `docker image inspect httpd`: 다운로드한 이미지 세부 정보 조회 → JSON 데이터 출력

               ![img_4.png](img_4.png)

    2. `docker image history` : 이 명령으로 현재 이미지 구성을 위해 사용된 레이블 정보와 각 레이어의 수행 명령, 크기 등을 조회 가능

        ```bash
        docker image history [OPTIONS] IMAGE
        ```

       ![img_5.png](img_5.png)

        - CREATED BY: 특정 이미지를 구성하기 위해 사용된 명령과 환경설정 정보 등 확인 가능
        - CMD, EXPOSE, ENV, WORKDIR 명령 등으로 베이스 이미지에 필요한 설정 정보를 결합해 새로운 이미지를 만들게 된다.
    